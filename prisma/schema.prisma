generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// --- ENUMS ---

enum SessionType {
  LEITURA
  VIDEO
  EXERCICIO
  REVISAO
  PROJETO
}

// --- MÓDULO USUÁRIO E ESTATÍSTICAS ---

model User {
  id            String         @id @default(uuid())
  name          String
  email         String         @unique
  password      String

  avatarUrl     String?
  bio           String?
  salary        Decimal?  @default(0)

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relacionamentos
  accounts      Account[]
  projects      Project[]
  jobApplications JobApplication[]
  accessItem    AccessItem[]
  friends       Friend[]
  wardrobe      WardrobeItem[] 
  stats         UserStats?
}

model UserStats {
  id                String         @id @default(uuid())
  
  // Rastreamento do usuário
  userId            String         @unique
  user              User           @relation(fields: [userId], references: [id])
  
  // ✅ STREAK E METAS
  currentStreak     Int            @default(0)
  lastStudyDate     DateTime?
  dailyGoalMinutes  Int            @default(60)
  
  // ✅ MEDALHAS
  badges            String?        @db.Text // JSON string: ["MASTER_FOCUS", "21_DAY_STREAK"]
  
  updatedAt         DateTime       @updatedAt
}

// --- MÓDULO FLASHCARDS ---

model FlashcardDeck {
  id              String        @id @default(uuid())
  title           String        // Ex: "Biologia - Capítulo 5"
  description     String?       @db.Text
  category        String?       // Ex: "Ciências", "Programação"
  
  studySubjectId  String?
  studySubject    StudySubject? @relation(fields: [studySubjectId], references: [id])

  // Relação com os cartões
  cards           Flashcard[]

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model Flashcard {
  id              String        @id @default(uuid())
  term            String        // Pergunta ou Frente (Ex: "O que é Mitose?")
  definition      String        @db.Text // Resposta ou Verso
  imageUrl        String?       @db.Text // Opcional: Imagem de ajuda
  
  // Campos para o Algoritmo de Repetição Espaçada (SM-2)
  box             Int           @default(1) // Caixa atual (Leitner system)
  nextReview      DateTime?     // Quando deve ser revisado novamente
  lastReviewed    DateTime?     // Última vez que foi estudado

  // Relação com o Baralho
  deckId          String
  deck            FlashcardDeck @relation(fields: [deckId], references: [id], onDelete: Cascade)

  createdAt       DateTime      @default(now())
}


// --- MÓDULO FINANCEIRO ---

model Account {
  id            String         @id @default(uuid())
  name          String
  type          String
  balance       Decimal        @default(0.00)
  color         String?        @default("#000000")

  isConnected   Boolean  @default(false)
  provider      String?  // "PLUGGY"
  externalId    String?  // ID da conta lá na Pluggy (itemId)

  transactions  Transaction[]

  userId        String?
  user          User?          @relation(fields: [userId], references: [id])

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Transaction {
  id            String   @id @default(uuid())
  description   String
  amount        Decimal
  type          String   // INCOME, EXPENSE
  category      String
  date          DateTime @default(now())

  accountId     String
  account       Account  @relation(fields: [accountId], references: [id])

  createdAt     DateTime @default(now())
}

model RecurringExpense {
  id            String   @id @default(uuid())
  title         String
  amount        Decimal
  dayOfMonth    Int
  category      String
  active        Boolean  @default(true)

  createdAt     DateTime @default(now())
}

model WishlistItem {
  id            String   @id @default(uuid())
  name          String
  price         Decimal
  saved         Decimal  @default(0.00)
  priority      String   @default("MEDIUM")

  imageUrl      String?  @db.Text
  productUrl    String?  @db.Text

  status        String   @default("SAVING")

  createdAt     DateTime @default(now())
}

// --- MÓDULO ESTUDOS (ATUALIZADO) ---

model StudySubject {
  id            String         @id @default(uuid())
  title         String
  category      String

  // ✅ NOVOS CAMPOS PARA VISUALIZAÇÃO E GAMIFICAÇÃO
  icon          String?
  difficulty    Int            @default(3)
  goalMinutes   Int            @default(3600)

  color         String         @default("blue")
  sessions      StudySession[]
  createdAt     DateTime       @default(now())
  decks         FlashcardDeck[]
}

model StudySession {
  id              String         @id @default(uuid())
  durationMinutes Int
  notes           String?        @db.Text
  date            DateTime       @default(now())

  // ✅ NOVOS CAMPOS PARA RIQUEZA DA SESSÃO
  focusLevel      Int            @default(3)
  tags            String?        @db.Text // JSON string: ["react", "performance"]
  type            SessionType    @default(LEITURA)

  subjectId       String
  subject         StudySubject   @relation(fields: [subjectId], references: [id], onDelete: Cascade)
}


// --- MÓDULO PROJETOS & TAREFAS ---

model Project {
  id            String   @id @default(uuid())
  title         String
  description   String?
  status        String   @default("ACTIVE")
  createdAt     DateTime @default(now())
  color         String?  @default("#6366f1")

  userId        String?
  user          User?    @relation(fields: [userId], references: [id])

  tasks         Task[]
  events        Event[]
}

model Task {
  id            String   @id @default(uuid())
  title         String
  isDone        Boolean  @default(false)
  dueDate       DateTime?

  priority      String   @default("MEDIUM")
  image         String?  @db.LongText
  projectId     String?
  project       Project? @relation(fields: [projectId], references: [id])

  createdAt     DateTime @default(now())
}

// --- MÓDULO VAGAS (JOB TRACKER) ---

model JobApplication {
  id            String   @id @default(uuid())
  company       String
  role          String
  status        String
  jobUrl        String?
  salary        String?
  location      String?
  requirements  String?  @db.Text

  type          String   @default("JOB")

  appliedDate   DateTime @default(now())
  updatedAt     DateTime @updatedAt

  userId        String?
  user          User?    @relation(fields: [userId], references: [id])
}

// --- MÓDULO SAÚDE ---

model Workout {
  id            String   @id @default(uuid())
  title         String
  type          String

  duration      Int
  intensity     String
  feeling       String?
  notes         String?  @db.Text

  distance      Float?
  pace          String?

  muscleGroup   String?
  exercises     String?  @db.Text

  date          DateTime @default(now())
}

model HealthMetric {
  id            String   @id @default(uuid())
  type          String
  value         Float
  date          DateTime @default(now())
}

// --- MÓDULO NUTRIÇÃO ---

model Meal {
  id            String   @id @default(uuid())
  title         String
  items         String
  calories      Int?
  type          String
  date          DateTime @default(now())
}

// --- MÓDULO AGENDA ---

model Event {
  id            String    @id @default(uuid())
  title         String
  startTime     DateTime
  endTime       DateTime?
  isAllDay      Boolean   @default(false)
  description   String?
  category      String    @default("general")

  location      String?
  color         String    @default("#6366f1")
  emailAlert    Boolean   @default(true)

  projectId     String?
  project       Project?  @relation(fields: [projectId], references: [id])

  createdAt     DateTime  @default(now())
}

model RoutineItem {
  id            String   @id @default(uuid())
  title         String
  startTime     String
  endTime       String
  description   String?  @db.Text
  category      String

  daysOfWeek    String

  createdAt     DateTime @default(now())
}

// --- MÓDULO CONFIGURAÇÕES ---

model Settings {
  id            String   @id @default(uuid())
  theme         String   @default("system")
  accentColor   String   @default("zinc")
  language      String   @default("pt-BR")

  aiProvider    String   @default("ollama")
  aiModel       String   @default("llama3")
  aiPersona     String?  @db.Text
  aiUsage       String?  @db.Text

  openaiKey     String?  @db.Text
  groqKey       String?  @db.Text
  googleKey     String?  @db.Text

  updatedAt     DateTime @updatedAt
}

// --- MÓDULO CMS ---

model ManagedSite {
  id            String      @id @default(uuid())
  name          String
  url           String?
  apiKey        String      @unique @default(uuid())
  createdAt     DateTime    @default(now())

  pages         SitePage[]
}

model SitePage {
  id            String      @id @default(uuid())
  slug          String
  content       String      @db.Text

  siteId        String
  site          ManagedSite @relation(fields: [siteId], references: [id], onDelete: Cascade)

  updatedAt     DateTime    @updatedAt
}

// --- MÓDULO IA ---

model AiChat {
  id            String      @id @default(uuid())
  title         String      @default("Nova Conversa")
  createdAt     DateTime    @default(now())
  messages      AiMessage[]
}

model AiMessage {
  id            String   @id @default(uuid())
  role          String
  content       String   @db.Text

  provider  String?  // ex: "ollama", "openai"
  model     String?  // ex: "llama3", "gpt-4"

  chatId        String
  chat          AiChat   @relation(fields: [chatId], references: [id], onDelete: Cascade)
  createdAt     DateTime @default(now())
}

// --- MÓDULO ACESSOS (VAULT) ---

model AccessItem {
  id            String   @id @default(uuid())
  title         String
  username      String?
  password      String
  url           String?
  category      String
  notes         String?  @db.Text

  userId        String?
  user          User?    @relation(fields: [userId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model SavedLink {
  id          String   @id @default(uuid())
  title       String
  url         String
  description String?  @db.Text
  imageUrl    String?  @db.Text // Para o visual "Meta Tag"
  category    String?  // Ex: "Design", "Dev", "Leitura"
  
  isFavorite  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model MediaItem {
  id          String   @id @default(uuid())
  type        String   // 'MOVIE', 'TV', 'ALBUM', 'SONG'
  title       String
  subtitle    String?  // Nome do Artista (Música) ou Ano (Filme)
  coverUrl    String?  @db.Text
  
  rating      Int      @default(0) // 0 a 5 estrelas
  category    String?  // "Favoritos", "Assistir Depois", "Ouvindo Agora"
  
  externalId  String?  // ID do TMDB ou iTunes (para evitar duplicatas)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Amigos

model Friend {
  id          String   @id @default(cuid())
  name        String
  nickname    String?  // O "Vulgo"
  email       String?
  phone       String?  // Para o botão de WhatsApp
  
  // Datas
  birthday    DateTime?
  
  // Social & Trabalho
  instagram   String?
  linkedin    String?
  twitter     String?
  jobTitle    String?  // Cargo
  company     String?  // Empresa
  
  // Detalhes Pessoais
  proximity   String   @default("CASUAL") // CLOSE, FAMILY, WORK, NETWORK
  pixKey      String?  // Útil para dividir contas
  address     String?  // Para mandar Uber/iFood
  notes       String?  // "Alergias", "Gostos", "Como conheci"

  imageUrl    String?  @db.Text // Foto do amigo
  giftIdeas   String?  @db.Text // O que dar de presente?
  
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model WardrobeItem {
  id          String   @id @default(uuid())
  name        String   // Ex: "Jaqueta de Couro Preta"
  
  // Detalhes Visuais
  imageUrl    String?  @db.LongText // Foto da peça
  brand       String?  // Ex: "Zara", "Nike"
  color       String?  // Ex: "#000000" ou "Preto"
  size        String?  // Ex: "M", "42", "US 9"
  
  // Classificação
  category    String   // Vamos usar String para flexibilidade, mas sugerir via UI (TOP, BOTTOM, SHOES...)
  season      String?  // "VERAO", "INVERNO", "TODAS"
  
  // Métricas Inteligentes (Pensando no Futuro)
  price       Decimal? // Quanto custou
  wearCount   Int      @default(0) // Quantas vezes usou (para calcular custo por uso)
  lastWorn    DateTime? // Última vez que usou
  
  // Estado
  isFavorite  Boolean  @default(false)
  status      WardrobeStatus @default(IN_CLOSET) // Onde está a peça?

  // Relacionamento
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Enums para deixar o sistema organizado
enum WardrobeStatus {
  IN_CLOSET   // Disponível
  LAUNDRY     // Lavando
  LENT        // Emprestado
  REPAIR      // Costureira/Conserto
  DONATED     // Doado (Histórico)
}