generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// --- MÓDULO USUÁRIO E ESTATÍSTICAS ---

model User {
  id              String   @id @default(uuid())
  name            String
  email           String   @unique
  password        String

  avatarUrl       String?
  coverUrl        String?
  bio             String?
  salary          Decimal? @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relacionamentos
  accounts        Account[]
  projects        Project[]
  jobApplications JobApplication[]
  accessItem      AccessItem[]
  friends         Friend[]
  wardrobe        WardrobeItem[] 
  stats           UserStats?
  settings        Settings?
  bodyMeasurements BodyMeasurement[]
}

model UserStats {
  id               String    @id @default(uuid())
  
  userId           String    @unique
  user             User      @relation(fields: [userId], references: [id])
  
  currentStreak    Int       @default(0)
  lastStudyDate    DateTime?
  dailyGoalMinutes Int       @default(60)
  
  badges           String?   // JSON string: ["MASTER_FOCUS", "21_DAY_STREAK"]
  
  updatedAt        DateTime  @updatedAt
}

// --- MÓDULO FLASHCARDS ---

model FlashcardDeck {
  id             String        @id @default(uuid())
  title          String        
  description    String?       
  category       String?       
  
  studySubjectId String?
  studySubject   StudySubject? @relation(fields: [studySubjectId], references: [id])

  cards          Flashcard[]

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model Flashcard {
  id           String        @id @default(uuid())
  term         String        
  definition   String        
  imageUrl     String?       
  
  box          Int           @default(1) 
  nextReview   DateTime?     
  lastReviewed DateTime?     

  deckId       String
  deck         FlashcardDeck @relation(fields: [deckId], references: [id], onDelete: Cascade)

  createdAt    DateTime      @default(now())
}


// --- MÓDULO FINANCEIRO ---

model Account {
  id           String        @id @default(uuid())
  name         String
  type         String
  balance      Decimal       @default(0.00)
  color        String?       @default("#000000")

  isConnected  Boolean       @default(false)
  provider     String?       
  externalId   String?       

  transactions Transaction[]

  userId       String?
  user         User?         @relation(fields: [userId], references: [id])

  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Transaction {
  id          String   @id @default(uuid())
  description String
  amount      Decimal
  type        String   // INCOME, EXPENSE
  category    String
  date        DateTime @default(now())

  accountId   String
  account     Account  @relation(fields: [accountId], references: [id])

  createdAt   DateTime @default(now())
}

model RecurringExpense {
  id         String   @id @default(uuid())
  title      String
  amount     Decimal
  dayOfMonth Int
  category   String
  active     Boolean  @default(true)

  createdAt  DateTime @default(now())
}

model WishlistItem {
  id         String   @id @default(uuid())
  name       String
  price      Decimal
  saved      Decimal  @default(0.00)
  priority   String   @default("MEDIUM")

  imageUrl   String?  
  productUrl String?  

  status     String   @default("SAVING")

  createdAt  DateTime @default(now())
}

// --- MÓDULO ESTUDOS ---

model StudySubject {
  id          String         @id @default(uuid())
  title       String
  category    String

  icon        String?
  difficulty  Int            @default(3)
  goalMinutes Int            @default(3600)

  color       String         @default("blue")
  sessions    StudySession[]
  createdAt   DateTime       @default(now())
  decks       FlashcardDeck[]
}

model StudySession {
  id              String       @id @default(uuid())
  durationMinutes Int
  notes           String?      
  date            DateTime     @default(now())

  focusLevel      Int          @default(3)
  tags            String?      // JSON string
  
  // SQLite não tem ENUM nativo, usamos String e validamos na app se necessário
  type            String       @default("LEITURA") // LEITURA, VIDEO, EXERCICIO...

  subjectId       String
  subject         StudySubject @relation(fields: [subjectId], references: [id], onDelete: Cascade)
}


// --- MÓDULO PROJETOS & TAREFAS ---

model Project {
  id          String   @id @default(uuid())
  title       String
  description String?
  status      String   @default("ACTIVE")
  createdAt   DateTime @default(now())
  color       String?  @default("#6366f1")

  userId      String?
  user        User?    @relation(fields: [userId], references: [id])

  tasks       Task[]
  events      Event[]
}

model Task {
  id        String   @id @default(uuid())
  title     String
  isDone    Boolean  @default(false)
  dueDate   DateTime?

  priority  String   @default("MEDIUM")
  image     String?  
  projectId String?
  project   Project? @relation(fields: [projectId], references: [id])

  createdAt DateTime @default(now())
}

// --- MÓDULO VAGAS (JOB TRACKER) ---

model JobApplication {
  id           String   @id @default(uuid())
  company      String
  role         String
  status       String
  jobUrl       String?
  salary       String?
  location     String?
  requirements String?  

  type         String   @default("JOB")

  appliedDate  DateTime @default(now())
  updatedAt    DateTime @updatedAt

  userId       String?
  user         User?    @relation(fields: [userId], references: [id])
}

// --- MÓDULO SAÚDE ---

model Workout {
  id          String   @id @default(uuid())
  title       String
  type        String

  duration    Int
  intensity   String
  feeling     String?
  notes       String?  

  distance    Float?
  pace        String?

  muscleGroup String?
  exercises   String?  

  date        DateTime @default(now())
}

model HealthMetric {
  id    String   @id @default(uuid())
  type  String
  value Float
  date  DateTime @default(now())
}

model BodyMeasurement {
  id        String   @id @default(uuid())
  date      DateTime @default(now())

  // Dados Básicos
  weight    Float
  height    Float
  gender    String   
  activity  Float    @default(1.2) // Adicionar valor padrão 
  birthDate DateTime?

  // Circunferências
  neck      Float?
  waist     Float?
  hip       Float?
  
  // Superiores
  shoulders Float?
  chest     Float?
  armLeft   Float?
  armRight  Float?
  forearmLeft  Float?
  forearmRight Float?

  // Inferiores
  thighLeft    Float?
  thighRight   Float?
  calfLeft     Float?
  calfRight    Float?

  // Relacionamento
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade) // Adicionei Cascade para limpar se o usuário for deletado

  @@index([date])
}

// --- MÓDULO NUTRIÇÃO ---

model Meal {
  id       String   @id @default(uuid())
  title    String
  items    String
  calories Int?
  type     String
  date     DateTime @default(now())
}

// --- MÓDULO AGENDA ---

model Event {
  id          String    @id @default(uuid())
  title       String
  startTime   DateTime
  endTime     DateTime?
  isAllDay    Boolean   @default(false)
  description String?
  category    String    @default("general")

  location    String?
  color       String    @default("#6366f1")
  emailAlert  Boolean   @default(true)

  projectId   String?
  project     Project?  @relation(fields: [projectId], references: [id])

  createdAt   DateTime  @default(now())
}

model RoutineItem {
  id          String   @id @default(uuid())
  title       String
  startTime   String
  endTime     String
  description String?  
  category    String

  daysOfWeek  String

  createdAt   DateTime @default(now())
}

// --- MÓDULO CONFIGURAÇÕES ---

model Settings {
  id          String   @id @default(uuid())
  theme       String   @default("system")
  accentColor String   @default("zinc")
  language    String   @default("pt-BR")

  currency    String   @default("BRL") // BRL, USD, EUR
  workStart   String   @default("09:00") // Início do dia produtivo
  workEnd     String   @default("18:00") // Fim do dia produtivo

  aiProvider  String   @default("ollama")
  aiModel     String   @default("llama3")
  aiPersona   String?  
  aiUsage     String?  

  userId          String? @unique // Relação 1:1: um Settings pertence a um User (ID)
  user            User?   @relation(fields: [userId], references: [id])

  tmdbApiKey      String? @map("tmdb_api_key")
  rawgApiKey      String? @map("rawg_api_key")
  pluggyClientId  String? @map("pluggy_client_id")
  pluggySecret    String? @map("pluggy_client_secret")
  openaiKey   String?  
  groqKey     String?  
  googleKey   String?  
  
  // Caminho do armazenamento (para o monitoramento de disco)
  storagePath String?  @default("D:/LifeOS_Data")

  updatedAt   DateTime @updatedAt
  onboardingCompleted Boolean @default(false)
}

// --- MÓDULO CMS ---

model ManagedSite {
  id        String     @id @default(uuid())
  name      String
  url       String?
  apiKey    String     @unique @default(uuid())
  createdAt DateTime   @default(now())

  pages     SitePage[]
}

model SitePage {
  id        String      @id @default(uuid())
  slug      String
  content   String      

  siteId    String
  site      ManagedSite @relation(fields: [siteId], references: [id], onDelete: Cascade)

  updatedAt DateTime    @updatedAt
}

// --- MÓDULO IA ---

model AiChat {
  id        String      @id @default(uuid())
  title     String      @default("Nova Conversa")
  createdAt DateTime    @default(now())
  messages  AiMessage[]
}

model AiMessage {
  id        String   @id @default(uuid())
  role      String
  content   String   

  provider  String?  
  model     String?  

  chatId    String
  chat      AiChat   @relation(fields: [chatId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

// --- MÓDULO ACESSOS (VAULT) ---

model AccessItem {
  id        String   @id @default(uuid())
  title     String
  username  String?
  password  String
  url       String?
  category  String
  notes     String?  

  client    String?  @map("client_name")
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SavedLink {
  id          String   @id @default(uuid())
  title       String
  url         String
  description String?  
  imageUrl    String?  
  category    String?  
  
  isFavorite  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model MediaItem {
  id         String   @id @default(uuid())
  type       String   
  title      String
  subtitle   String?  
  coverUrl   String?  
  
  rating     Int      @default(0) 
  category   String?  
  
  externalId String?  
  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

// --- MÓDULO SOCIAL (AMIGOS) ---

model Friend {
  id        String    @id @default(cuid())
  name      String
  nickname  String?   
  email     String?
  phone     String?   
  
  birthday  DateTime?
  
  instagram String?
  linkedin  String?
  twitter   String?
  jobTitle  String?   
  company   String?   
  
  proximity String    @default("CASUAL") 
  pixKey    String?   
  address   String?   
  notes     String?   

  imageUrl  String?   
  giftIdeas String?   
  
  userId    String
  user      User      @relation(fields: [userId], references: [id])
  
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

// --- MÓDULO WARDROBE (ROUPAS) ---

model WardrobeItem {
  id         String   @id @default(uuid())
  name       String   
  
  imageUrl   String?  
  brand      String?  
  color      String?  
  size       String?  
  
  category   String   
  season     String?  
  
  price      Decimal? 
  wearCount  Int      @default(0) 
  lastWorn   DateTime? 
  
  isFavorite Boolean  @default(false)
  status     String   @default("IN_CLOSET") // Convertido de Enum para String

  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}