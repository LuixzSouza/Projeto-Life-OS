generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String   // Hash (simulado por enquanto)
  
  // Novos campos:
  avatarUrl String?  // URL de uma imagem da internet
  bio       String?  // Ex: "Fullstack Developer focado em Next.js"
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relacionamentos (Agora vai funcionar pois o outro lado existe)
  accounts  Account[]
  projects  Project[]
  jobApplications JobApplication[]
  accessItem  AccessItem[]
}

// --- MÃ“DULO FINANCEIRO (ATUALIZADO) ---

model Account {
  id          String        @id @default(uuid())
  name        String        // Nubank, Carteira
  type        String        // CHECKING, SAVINGS, CASH, INVESTMENT
  balance     Decimal       @default(0.00)
  color       String?       @default("#000000") 
  transactions Transaction[]
  
  userId      String?
  user        User?         @relation(fields: [userId], references: [id])
  
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model Transaction {
  id          String   @id @default(uuid())
  description String
  amount      Decimal
  type        String   // INCOME, EXPENSE
  category    String
  date        DateTime @default(now())
  
  // Relacionamentos
  accountId   String
  account     Account  @relation(fields: [accountId], references: [id])
  
  createdAt   DateTime @default(now())
}

// ASSINATURAS RECORRENTES
model RecurringExpense {
  id          String   @id @default(uuid())
  title       String   // "Spotify"
  amount      Decimal  // 19.90
  dayOfMonth  Int      // Dia de vencimento (ex: 10)
  category    String   // "Lazer"
  active      Boolean  @default(true)
  
  createdAt   DateTime @default(now())
}

// METAS DE COMPRA
model WishlistItem {
  id          String   @id @default(uuid())
  name        String   
  price       Decimal  
  saved       Decimal  @default(0.00) 
  priority    String   @default("MEDIUM")
  
  // MUDANÃ‡A AQUI: Adicionar @db.Text para aceitar URLs gigantes
  imageUrl    String?  @db.Text 
  productUrl  String?  @db.Text 
  
  status      String   @default("SAVING") 

  createdAt   DateTime @default(now())
}

// --- MÃ“DULO ESTUDOS ---

model StudySubject {
  id        String   @id @default(uuid())
  title     String   // Ex: "Next.js", "InglÃªs"
  category  String   // Ex: "ProgramaÃ§Ã£o", "Idiomas"
  color     String   @default("blue") // blue, red, green...
  sessions  StudySession[]
  createdAt DateTime @default(now())
}

model StudySession {
  id              String       @id @default(uuid())
  durationMinutes Int          // Tempo total em minutos
  notes           String?      @db.Text
  date            DateTime     @default(now())
  
  subjectId       String
  subject         StudySubject @relation(fields: [subjectId], references: [id])
}

// --- MÃ“DULO PROJETOS & TAREFAS ---

model Project {
  id          String   @id @default(uuid())
  title       String
  description String?
  status      String   @default("ACTIVE") // ACTIVE, COMPLETED, ARCHIVED
  createdAt   DateTime @default(now())

  color        String?   @default("#6366f1") // Cor padrÃ£o (Ex: Indigo)
  
  // CORREÃ‡ÃƒO: Relacionamento com User
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])
  
  tasks       Task[]
  events       Event[]
}

model Task {
  id          String   @id @default(uuid())
  title       String
  isDone      Boolean  @default(false)
  dueDate     DateTime?
  
  priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH
  image       String?  @db.LongText
  projectId   String?
  project     Project? @relation(fields: [projectId], references: [id])
  
  createdAt   DateTime @default(now())
}

// --- MÃ“DULO VAGAS (JOB TRACKER) ---

model JobApplication {
  id          String   @id @default(uuid())
  company     String   // Nome da Empresa ou Cliente
  role        String   // Cargo ou ServiÃ§o (ex: "Landing Page")
  status      String   // APPLIED, INTERVIEW, etc...
  jobUrl      String?
  salary      String?  // Valor ou OrÃ§amento
  location    String?
  requirements String? @db.Text
  
  // NOVO CAMPO:
  type        String   @default("JOB") // "JOB" ou "FREELANCE"
  
  appliedDate DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])
}

// --- MÃ“DULO SAÃšDE ---

model Workout {  
  id        String   @id @default(uuid())
  title     String   // Ex: "Treino A" ou "Corrida Matinal"
  type      String   // "GYM", "RUN", "SPORT"
  
  // CAMPOS GERAIS
  duration  Int      // Minutos totais
  intensity String   // LOW, MEDIUM, HIGH
  feeling   String?  // Emojis: ðŸ˜„, ðŸ˜«, ðŸ”¥
  notes     String?  @db.Text

  // CAMPOS DE CORRIDA
  distance  Float?   // Km (apenas para RUN)
  pace      String?  // Min/Km (calculado ou inserido)

  // CAMPOS DE MUSCULAÃ‡ÃƒO (JSON para lista de exercÃ­cios)
  muscleGroup String? // "CHEST", "LEGS", "BACK", "ARMS"
  exercises   String? @db.Text // JSON string: [{name: "Supino", sets: 3, reps: 10, weight: 20}]

  date      DateTime @default(now())
}

model HealthMetric {
  id    String   @id @default(uuid())
  type  String   // "WEIGHT", "WATER", "HEIGHT" (Novo: Altura para IMC)
  value Float    
  date  DateTime @default(now())
}

// --- MÃ“DULO NUTRIÃ‡ÃƒO ---

model Meal {
  id        String   @id @default(uuid())
  title     String   // "AlmoÃ§o", "Jantar", "Lanche"
  items     String   // "Arroz, FeijÃ£o, Frango"
  calories  Int?     // Estimativa (opcional)
  type      String   // "HEALTHY" (SaudÃ¡vel), "TRASH" (Lixo/Cheat Meal), "NEUTRAL"
  date      DateTime @default(now())
}

// --- MÃ“DULO AGENDA ---

model Event {
  id          String    @id @default(uuid())
  title       String
  startTime   DateTime
  endTime     DateTime?
  isAllDay    Boolean   @default(false)
  description String?
  category    String    @default("general")
  
  // --- NOVOS CAMPOS ---
  location    String?   // Ex: "Google Meet", "Av. Paulista, 1000"
  color       String    @default("#6366f1") // Cor do evento (Indigo default)
  emailAlert  Boolean   @default(true) // ConfiguraÃ§Ã£o de notificaÃ§Ã£o
  
  projectId   String?
  project     Project?  @relation(fields: [projectId], references: [id])
  
  createdAt   DateTime  @default(now())
}

model RoutineItem {
  id          String   @id @default(uuid())
  title       String   // Ex: "Treino"
  startTime   String   // "07:00" (Guardamos como string HH:mm para simplificar repetiÃ§Ã£o)
  endTime     String   // "08:00"
  description String?  @db.Text
  category    String   // "health", "study", "work", "leisure", "home"
  
  // Define em quais dias isso acontece
  // Ex: "mon,tue,wed,thu" ou "fri" ou "weekend"
  daysOfWeek  String   
  
  createdAt   DateTime @default(now())
}

// --- MÃ“DULO CONFIGURAÃ‡Ã•ES ---

model Settings {
  id          String   @id @default(uuid())
  theme       String   @default("system")
  accentColor String   @default("zinc")
  language    String   @default("pt-BR")
  
  aiProvider  String   @default("ollama")
  aiModel     String   @default("llama3")
  aiPersona   String?  @db.Text
  
  updatedAt   DateTime @updatedAt
}

// --- MÃ“DULO CMS ---

model ManagedSite {
  id        String   @id @default(uuid())
  name      String   // Ex: "Landing Page Advogado"
  url       String?  // Ex: "https://advogado.com"
  apiKey    String   @unique @default(uuid()) // A chave para o site externo acessar
  createdAt DateTime @default(now())
  
  pages     SitePage[]
}

model SitePage {
  id          String      @id @default(uuid())
  slug        String      // Ex: "home", "sobre", "contato"
  content     String      @db.Text // JSON stringificado
  
  siteId      String
  site        ManagedSite @relation(fields: [siteId], references: [id], onDelete: Cascade)
  
  updatedAt   DateTime    @updatedAt
}

// --- MÃ“DULO IA ---

model AiChat {
  id        String      @id @default(uuid())
  title     String      @default("Nova Conversa")
  createdAt DateTime    @default(now())
  messages  AiMessage[]
}

model AiMessage {
  id        String   @id @default(uuid())
  role      String   // "user" ou "assistant"
  content   String   @db.Text
  chatId    String
  chat      AiChat   @relation(fields: [chatId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

// --- MÃ“DULO ACESSOS (VAULT) ---

model AccessItem {
  id          String   @id @default(uuid())
  title       String   // "Nubank", "Instagram"
  username    String?  // "luiz@email.com"
  password    String   // A senha em si
  url         String?  // "https://nubank.com.br"
  category    String   // SOCIAL, FINANCE, WORK, OTHERS
  notes       String?  @db.Text // "Pin de seguranÃ§a: 1234"
  
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}